
  CREATE OR REPLACE VIEW REPORT_HRCHY_EMP_DTLS_VW (HRCHY_HDR_NAME, LEVEL_VALUE, EMPLOYEE_NAME) AS 
  SELECT HRCHY_HDR_NAME,
       DECODE(HRCHY_HDR_NAME, 
              'ADMIN_TO_SALES_DIVISION', SUBSTR(HRCHY_DTL_PREV_LVL_VAL,5,2),
              'ADMIN_TO_SALES_AREA', SUBSTR(HRCHY_DTL_PREV_LVL_VAL,5,4),
              'ADMIN_TO_SALES_DISTRICT', SUBSTR(HRCHY_DTL_PREV_LVL_VAL,5,6),
              NULL),
       (SELECT EMPLOYEE_NAME
          FROM EMPLOYEE_DETAILS
         WHERE EMPLOYEE_NUMBER = SUBSTR(SD_REPORT_PKG.GET_RQSTD_ATTRIBUTE_VALUE(HD.UPPER_LVL_VER_VALUE,'MANAGERNAME'),4)) EMPLOYEE_NAME
  FROM HIERARCHY_DETAIL HD
 WHERE HRCHY_HDR_NAME IN ('ADMIN_TO_SALES_AREA','ADMIN_TO_SALES_DISTRICT','ADMIN_TO_SALES_DIVISION')
   AND EXISTS (SELECT 1
                 FROM EMPLOYEE_DETAILS
                WHERE SUBSTR(SD_REPORT_PKG.GET_RQSTD_ATTRIBUTE_VALUE(HD.UPPER_LVL_VER_VALUE,'MANAGERNAME'),4) = EMPLOYEE_NUMBER);

