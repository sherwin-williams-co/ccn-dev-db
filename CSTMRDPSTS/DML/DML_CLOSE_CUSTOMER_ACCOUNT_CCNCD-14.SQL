/*
Script Name : DML_CLOSE_CUSTOMER_ACCOUNT_CCNCCD-14.sql
Purpose     : For closing the customer accounts due to inactivity by setting closed date with current date and cleared_reason as 'Aged Deposit'
              Account list are taken from CD_ACC_CLOSE_LIST.csv files.

Created     : 08/29/2019 akj899  CCNCd-14 CCN Project....
*/

    SELECT COUNT(*) 
      FROM CUSTOMER_DEPOSIT_TRANSACTION_DTL 
      WHERE CUSTOMER_ACCOUNT_NUMBER IN (SELECT CUSTOMER_NUMBER FROM TEMP_CD_ACC_CLOSE_LIST)
        AND CLOSED_DATE IS  NULL;
    
    UPDATE CUSTOMER_DEPOSIT_TRANSACTION_DTL
       SET CLOSED_DATE = TRUNC(SYSDATE),
           CLEARED_REASON = 'Aged Deposit'
     WHERE CUSTOMER_ACCOUNT_NUMBER IN (SELECT CUSTOMER_NUMBER FROM TEMP_CD_ACC_CLOSE_LIST)
       AND CLOSED_DATE IS  NULL;
       
    SELECT COUNT(*) 
      FROM CUSTOMER_DEPOSIT_TRANSACTION_DTL 
     WHERE CUSTOMER_ACCOUNT_NUMBER IN (SELECT CUSTOMER_NUMBER FROM TEMP_CD_ACC_CLOSE_LIST)
       AND CLOSED_DATE IS  NULL;
    
    SELECT COUNT(*)
      FROM CUSTOMER_DEPOSIT_TRANSACTION_DTL 
     WHERE CUSTOMER_ACCOUNT_NUMBER IN (SELECT CUSTOMER_NUMBER FROM TEMP_CD_ACC_CLOSE_LIST)
       AND CLEARED_REASON =  'Aged Deposit';

    COMMIT;