--Script that inserts the m issing records for run cycles available in both the tables (pre and post live)
--Data overlap in the intermediate tables
--The 3 run cycles where the data was overlapping are 1333, 1334 and 1335
--Created : 08/11/2018 sxh487 CCN Project Team....

SELECT * FROM cust_dep_ccn_accums_t WHERE rls_run_cycle IN (1333, 1334, 1335);
SELECT * FROM ccn_headers_t WHERE rls_run_cycle IN (1333, 1334, 1335);--262832
SELECT * FROM ccn_sales_lines_t WHERE rls_run_cycle IN (1333, 1334, 1335);--548672

DELETE FROM CUST_DEP_CCN_ACCUMS_T WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335);
DELETE FROM CCN_HEADERS_T WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335);
DELETE FROM CCN_SALES_LINES_T WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335);

INSERT INTO CUST_DEP_CCN_ACCUMS_T
(SELECT TRAN_GUID, AMT, ACCUM_ID, RLS_RUN_CYCLE, SYSDATE FROM PNP.CCN_ACCUMS A WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335)
 UNION
 SELECT TRAN_GUID, AMT, ACCUM_ID, RLS_RUN_CYCLE, SYSDATE FROM PNP.PRE_GO_LIVE_ACCUMS A WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335)
 );;
 
INSERT INTO CCN_HEADERS_T
(SELECT * FROM PNP.CCN_HEADERS A WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335)
 UNION
 SELECT * FROM PNP.PRE_GO_LIVE_HEADERS A WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335));
 
INSERT INTO CCN_SALES_LINES_T
(SELECT * FROM PNP.CCN_SALES_LINES A WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335)
 UNION
 SELECT * FROM PNP.PRE_GO_LIVE_SALES A WHERE RLS_RUN_CYCLE IN (1333, 1334, 1335));
 
COMMIT;
