/**********************************************************
created : 04/15/2015 jxc517 CCN Project....
          Territory users can not deal with global hierarchy 6th level with non-alphabets
          the code changes here are to send the dummy YY as @@ for 6th level value of global hierarchy
          
          Below script will replace all the level 6 @@ with YY for all the levels including history
          so that territory users can work with just alphabets rather than @@
**********************************************************/
--Below script will replace all the level 6 @@ with YY for all the levels including history
--HIERARCHY_DETAIL clean-up
SELECT * FROM HIERARCHY_DETAIL
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 5;
UPDATE HIERARCHY_DETAIL
   SET HRCHY_DTL_NEXT_LVL_VAL = SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL)+1,13))
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 5;
SELECT * FROM HIERARCHY_DETAIL
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 6;
UPDATE HIERARCHY_DETAIL
   SET HRCHY_DTL_CURR_LVL_VAL = SUBSTR(HRCHY_DTL_CURR_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_CURR_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL)+1,13)),
       HRCHY_DTL_NEXT_LVL_VAL = SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL)+1,13)),
       HRCHY_DTL_CURR_ROW_VAL = 'YY'
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 6;
SELECT * FROM HIERARCHY_DETAIL
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL IN (7,8);
UPDATE HIERARCHY_DETAIL
   SET HRCHY_DTL_PREV_LVL_VAL = SUBSTR(HRCHY_DTL_PREV_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_PREV_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL)+1,13)),
       HRCHY_DTL_CURR_LVL_VAL = SUBSTR(HRCHY_DTL_CURR_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_CURR_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL)+1,13)),
       HRCHY_DTL_NEXT_LVL_VAL = SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL)+1,13))
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL IN (7,8);
SELECT * FROM HIERARCHY_DETAIL
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 9;
UPDATE HIERARCHY_DETAIL
   SET HRCHY_DTL_PREV_LVL_VAL = SUBSTR(HRCHY_DTL_PREV_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_PREV_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL)+1,13)),
       HRCHY_DTL_CURR_LVL_VAL = SUBSTR(HRCHY_DTL_CURR_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_CURR_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL)+1,13))
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 9;
--HIERARCHY_DETAIL_HST clean-up
SELECT * FROM HIERARCHY_DETAIL_HST
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 5;
UPDATE HIERARCHY_DETAIL_HST
   SET HRCHY_DTL_NEXT_LVL_VAL = SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL)+1,13))
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 5;
SELECT * FROM HIERARCHY_DETAIL_HST
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 6;
UPDATE HIERARCHY_DETAIL_HST
   SET HRCHY_DTL_CURR_LVL_VAL = SUBSTR(HRCHY_DTL_CURR_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_CURR_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL)+1,13)),
       HRCHY_DTL_NEXT_LVL_VAL = SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL)+1,13)),
       HRCHY_DTL_CURR_ROW_VAL = 'YY'
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 6;
SELECT * FROM HIERARCHY_DETAIL_HST
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL IN (7,8);
UPDATE HIERARCHY_DETAIL_HST
   SET HRCHY_DTL_PREV_LVL_VAL = SUBSTR(HRCHY_DTL_PREV_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_PREV_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL)+1,13)),
       HRCHY_DTL_CURR_LVL_VAL = SUBSTR(HRCHY_DTL_CURR_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_CURR_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL)+1,13)),
       HRCHY_DTL_NEXT_LVL_VAL = SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_NEXT_LVL_VAL)+1,13))
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL IN (7,8);
SELECT * FROM HIERARCHY_DETAIL_HST
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 9;
UPDATE HIERARCHY_DETAIL_HST
   SET HRCHY_DTL_PREV_LVL_VAL = SUBSTR(HRCHY_DTL_PREV_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_PREV_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_PREV_LVL_VAL)+1,13)),
       HRCHY_DTL_CURR_LVL_VAL = SUBSTR(HRCHY_DTL_CURR_LVL_VAL,1,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL),10))||'YY'||SUBSTR(HRCHY_DTL_CURR_LVL_VAL,LEAST(LENGTH(HRCHY_DTL_CURR_LVL_VAL)+1,13))
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = '@@' AND HRCHY_DTL_LEVEL = 9;
 
 /*
 SELECT * FROM HIERARCHY_DETAIL
  WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL = 5;
 SELECT * FROM HIERARCHY_DETAIL
  WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL = 6;
 SELECT * FROM HIERARCHY_DETAIL
  WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL IN (7,8);
 SELECT * FROM HIERARCHY_DETAIL
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL = 9;

 SELECT * FROM HIERARCHY_DETAIL_HST
  WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_NEXT_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL = 5;
 SELECT * FROM HIERARCHY_DETAIL_HST
  WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL = 6;
 SELECT * FROM HIERARCHY_DETAIL_HST
  WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL IN (7,8);
 SELECT * FROM HIERARCHY_DETAIL_HST
 WHERE HRCHY_HDR_NAME = 'GLOBAL_HIERARCHY' AND SUBSTR(HRCHY_DTL_CURR_LVL_VAL,11,2) = 'YY' AND HRCHY_DTL_LEVEL = 9;
 */
 
 COMMIT; --please commit only after validating the results by running above commented scripts
 