/*
created : nxk927 04/18/2018
          Updating Pos last transaction date and last tran number
*/

DECLARE
CURSOR CUR IS
  SELECT COST_CENTER_CODE, 
         TERMINAL_NUMBER, 
         EFFECTIVE_DATE, 
         EXPIRATION_DATE,
         TO_DATE(LTRIM(POS_LAST_TRAN_DATE, '0'),'YYYYMMDD') POS_LAST_TRAN_DATE, 
         POS_LAST_TRAN_NUMBER,
         POLLING_STATUS_CODE
    FROM TEMP_TERMINAL
    WHERE (COST_CENTER_CODE, TERMINAL_NUMBER) IN (SELECT COST_CENTER_CODE, TERMINAL_NUMBER 
                                                 FROM TERMINAL
                                                WHERE EXPIRATION_DATE IS NULL)
      AND EXPIRATION_DATE = '00000000';
      
   V_COUNT NUMBER := 0;
BEGIN
  FOR REC IN CUR LOOP
      
      UPDATE TERMINAL
         SET POS_LAST_TRAN_DATE   =   REC.POS_LAST_TRAN_DATE,
             POS_LAST_TRAN_NUMBER =   REC.POS_LAST_TRAN_NUMBER
       WHERE COST_CENTER_CODE     = REC.COST_CENTER_CODE
         AND TERMINAL_NUMBER      = REC.TERMINAL_NUMBER
         AND EXPIRATION_DATE IS NULL;
      V_COUNT := V_COUNT + 1;
      IF V_COUNT = 500 THEN
         V_COUNT:= 0;
         COMMIT;
      END IF;
  END LOOP;
  COMMIT;
END;