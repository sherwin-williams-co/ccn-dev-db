DECLARE
    V_ACQUISITION_CODE COST_CENTER.ACQUISITION_CODE%TYPE;
BEGIN
    --lock all users out and Disable the triggers
    CCN_BATCH_PKG.LOCK_DATABASE_SP(); -- PRAGMA AUTONOMOUS_TRANSACTION;
    COMMON_TOOLS.ALTER_ALL_TRIGGERS('DISABLE');

    FOR REC IN (SELECT * FROM COST_CENTER) LOOP
        BEGIN
            SELECT ACQUISITION_CODE
              INTO V_ACQUISITION_CODE
              FROM (SELECT EXTRACTVALUE(TABLE_ROW_DATA, '/COST_CENTER/STATEMENT_TYPE') ACQUISITION_CODE
                      FROM AUDIT_LOG
                     WHERE TRANSACTION_ID LIKE '%'|| REC.COST_CENTER_CODE ||'%'
                       AND TABLE_NAME = 'COST_CENTER'
                     ORDER BY 1)
             WHERE ROWNUM < 2;
        EXCEPTION
            WHEN OTHERS THEN
                V_ACQUISITION_CODE := NULL;
        END;
        UPDATE COST_CENTER
           SET ACQUISITION_CODE = V_ACQUISITION_CODE
         WHERE COST_CENTER_CODE = REC.COST_CENTER_CODE;
    END LOOP;

    --unlock all users and Enable the triggers
    COMMON_TOOLS.ALTER_ALL_TRIGGERS('ENABLE');
    CCN_BATCH_PKG.UNLOCK_DATABASE_SP(); -- PRAGMA AUTONOMOUS_TRANSACTION; 
END;
/
