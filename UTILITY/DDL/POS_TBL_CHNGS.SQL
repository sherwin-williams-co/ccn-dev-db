-- Re-structuring the POS tables per new design 
-- Changed by rxv940 on 10/26/2017
-- Run this in Util schema


ALTER TABLE POS_DOWNLOADS 
RENAME TO POS_DOWNLOADS_BKP_FR_RNM;

-- remove comments column
CREATE TABLE POS_DOWNLOADS
(
  POS_ID	NUMBER
, COST_CENTER_CODE	VARCHAR2(6)
, DATA_SOURCE	VARCHAR2(30)
, DATA_OPERATION	VARCHAR2(100)
, FILE_PROCESSED	VARCHAR2(1)
, FILE_TYPE	VARCHAR2(100)
, CREATE_DT	DATE
, FILE_NAME	VARCHAR2(100)
, POLLING_REQUEST_ID	VARCHAR2(4000)
, UPDATE_DT	DATE
, PREREQ_EQUIV_RQST_ID	VARCHAR2(36)
);

CREATE INDEX POS_DOWNLOADS_FILE_NAME_IDX ON POS_DOWNLOADS (FILE_NAME);

INSERT INTO POS_DOWNLOADS
(POS_ID, COST_CENTER_CODE, DATA_SOURCE, DATA_OPERATION, FILE_PROCESSED, FILE_TYPE, CREATE_DT, FILE_NAME, POLLING_REQUEST_ID, UPDATE_DT, PREREQ_EQUIV_RQST_ID)
SELECT 
POS_ID, COST_CENTER_CODE, DATA_SOURCE, DATA_OPERATION, FILE_PROCESSED, FILE_TYPE, CREATE_DT, FILE_NAME, POLLING_REQUEST_ID, UPDATE_DT, PREREQ_EQUIV_RQST_ID
FROM POS_DOWNLOADS_BKP_FR_RNM;

COMMIT;

GRANT SELECT ON POS_DOWNLOADS TO COSTCNTR, BANKING;


************************************************************************************************

ALTER TABLE POS_DOWNLOADS_GL_PS 
ADD PREREQ_EQUIV_RQST_ID	VARCHAR2(36);

ALTER TABLE POS_DOWNLOADS_GL_PS 
DROP COLUMN COMMENTS;



************************************************************************************************

ALTER TABLE POS_DOWNLOADS_NON_TAXWARE 
ADD PREREQ_EQUIV_RQST_ID	VARCHAR2(36);

ALTER TABLE POS_DOWNLOADS_NON_TAXWARE 
DROP COLUMN COMMENTS;

CREATE INDEX POS_DWNLD_NON_TAX_FL_NM_IDX ON POS_DOWNLOADS_NON_TAXWARE (FILE_NAME);
CREATE INDEX POS_DWNLD_GL_PS_FL_NM_IDX ON POS_DOWNLOADS_GL_PS (FILE_NAME);

************************************************************************************************
GRANT EXECUTE ON POS_DOWNLOADS_INTERFACE_PKG TO COSTCNTR;   --> Utils



